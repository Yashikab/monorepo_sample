# モノレポのビルドツールを試す

結論Pantsを使ってみる

## モノレポとはなにか

- 単一のリポジトリに複数の個別のプロジェクトが存在し、互いに関係しあっている
- ただのコード共有の場ではない

## なぜモノレポか？

- polyrepo: 標準的な開発方法
  - どのリポジトリも単一のアーティファクトやパイプラインをビルドする
  - チーム自立性の観点からポリリポへ移行した経緯がある
  - 一方で、面倒なコード共有・重要なコードの重複・コストのかかるリポジトリ横断の開発・一貫性のないツールが課題になる
- monorepo: これらの課題を解決する。がどうやって？
  - 新しいプロジェクトをつくることに対するオーバーヘッドがない
  - プロジェクト横断の原子コミット麺と
  - すべてが一つのバージョンである
  - 開発者が開発しやすい

## モノレポの特徴

- モノレポのツールは何を提供してくれるのか
  - モノレポは有利だけどちゃんと運用するには正しいツールが必要
  - ワークスペースが大きくなるに従ってツールは君を助けてくれるし、理解できるようになるし管理しつづけられる

### 速さの観点

#### local computation caching

- ファイルとタスクのプロセス出力をストア・リプレイする能力。同じマシンで二度も同じものをビルドやテストしなくて済むようにする。

#### local task orchestration

- 正しい順序や並列してタスクを実行できる能力

#### distributed computation caching

- 違う環境にまたがってアーティファクトのキャッシュ共有ができる能力
- CIエージェントを含むすべての組織で二度も同じビルドやテストをしなくて済むようにできる

#### distributed task execution

- いくつものマシンにまたがってコマンドを分配させる能力

#### transparent remote execution

- ローカルで開発する間、複数のマシン上ですべてのコマンドを実行する能力

#### Detecting affected projects/packages

- 変更によって影響を受けるものを特定し、それだけをビルドやテストする

### 理解度の観点

### workspace analysis

- 余計な設定なくワークスペースのプロジェクトグラフを理解する能力

#### Dependency graph visualization

- プロジェクトやタスク間の依存関係を可視化できるか

### 管理観点

#### source code sharing

- ソースコードの離散的なものを共有する

#### consistent tooling

- 何を使って（言語など）かに関わらず一貫性のある体験を得られるツールか？さまざまな言語に対応しているか？

#### code generation

- コードを生成する機構

#### project constraints and visibility

- リポジトリ内の依存関係に制約をかけることができるか。

## どのツールを使うか?

## 参考

- [monorepo.tools](https://monorepo.tools/)
